---
description: Automatically generated description.
publishDate: 2010-09-09
published: true
title: Инициализация полей класса
---

	Два дня убил на выявление одной подлой ошибки. Проблема была в том, что на одном компьютере программа работала исправно, а на другом &#8211; segmentation fault.


	Ошибка возникала по вине неинициализированной переменной (которая представляла собой файловый дескриптор).


	А не проявлялась она на одном из компьютеров, по-видимому, из-за различий версий компилятора С++.


	Проблема демонстрируется следующим кодом:


<pre><code>class MyClass {
        int myField;
public:
        MyClass(){}
        ~MyClass(){}
        int getMyField(){return myField;}
};</code></pre>

	Создадим два объекта этого класса, один &#8211; в куче, другой &#8211; в стеке, и выведем поля:


<pre><code>#include &lt;iostream&gt;
int main(){
        MyClass *obj = new MyClass();
        std::cout &lt;&lt; obj-&gt;getMyField() &lt;&lt; std::endl;
        MyClass obj2;
        std::cout &lt;&lt; obj2.getMyField() &lt;&lt; std::endl;
}</code></pre>


	Теперь скомпилируем программу в различных версиях компилятора и посмотрим на результаты её выполнения.


<pre><code>$ g++-4.3 main.cpp -o 4.3 &amp;&amp; g++-4.4 main.cpp -o 4.4
$ ./4.3 &amp;&amp; ./4.4
0
-1217331212
0
134514832</code></pre>

	В первом случае результаты одинаковы &#8211; поле успешно инициализировано. Второй же случай более интересен. Мы видим, что новая версия компилятора инициализирует переменную положительной константой (вы можете убедиться в этом, несколько раз запуская программу), тогда как в результате компиляции версией 4.3 получаем меняющееся от запуска к запуску значение в неинициализированном поле класса.


	<h2>Вывод</h2>

	Если вы планируете создавать объекты в стеке &#8211; инициализируйте все поля класса. Инициализируйте их в любом случае, так, на всякий случай.


	<h2>To read</h2>

	<ul>
		- [C++ <span class="caps">FAQ</span>. Constructors](http://www.parashift.com/c%2B%2B-faq-lite/ctors.html)
	</ul>

	<h2>P.S.</h2>

	Насколько я знаю, Java и C# не допускает неинициализированных полей.
