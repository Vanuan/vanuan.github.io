---
description: A journey building a blog with Ruby on Rails, from initial setup to adding features like comments, tagging, and authorization.
publishDate: 2010-11-27
title: Создание моего блога на Rails
---

Этот сайт создан с использованием технологии Ruby on Rails!  Я использую его как песочницу для обучения и экспериментов, и этот пост - ретроспектива процесса разработки.

**2010-08-25: Задачи**

История:
	<ul>
	- Начало. 24.08.2010
	- Локализация. 24.08.2010-25.08.2010
	- Стили и первоначальный дизайн. 25.08.2010
	- Рефакторинг. 25.08.2010, 26.08.2010
	- Сортировать записи от новых к старым. 25.08.2010
	- Добавлены заголовки страниц. 25.08.2010
	- Добавлена иконка :). 25.08.2010
	- Форматирование сообщений при помощи textile. 25.08.2010
	- Отобразить дату публикации. 25.08.2010
	- Защита от notextile. 26.08.2010
	- Исправлен заголовок страницы при просмотре записи. 26.08.2010
	- Switched to Rails 3. 29.08.2010
	- Добавлена возможность комментирования. 06.09.2010
	- Добавлена постраничная навигация 11.09.2010
	- Добавлена возможность присвоения меток сообщениям 23.09.2010
	</ul>

**2010-08-24: Rails Rocks!**

<p>“Ruby on Rails is a breakthrough in lowering the barriers of entry to programming.<br />
Powerful web applications that formerly might have taken weeks or months<br />
to develop can be produced in a matter of days.”</p>

Я обновился до Rails 3. Ресурсы, которые мне очень помогли:

<ul>
    <li>[The Getting Started Guide](http://guides.rubyonrails.org/getting_started.html)
        <ul>
            - [i18n](http://guides.rubyonrails.org/i18n.html)
        </ul></li>
    - [Ruby on Rails Tutorial Book](http://www.railstutorial.org/)
    - [Agile Web Development with Rails, 4th Edition](http://pragprog.com/titles/rails4/agile-web-development-with-rails)
</ul>

**2010-08-25: Добавил стиля**

Первоначальное внимание было уделено запуску основной функциональности. Это включало настройку основных моделей, представлений и контроллеров для создания, чтения, обновления и удаления сообщений в блоге.

**2010-08-26: Show and Index**

Я создал partial `_showpost.html.erb`, который можно использовать как на странице индекса (список всех сообщений), так и на странице отображения (отображение одного сообщения). Это помогло сохранить код DRY (Don't Repeat Yourself). Сделано.

**2010-08-27: Текущее состояние сайта**

В настоящее время сайт поддерживает:

<p>Страницы:
	<ul>
		<li>Редактирование
		<ul>
			- Новая запись
			- Редактирование записи
		</ul></li>
		<li>Просмотр
		<ul>
			- Просмотр списка записей
			- Просмотр записи
		</ul></li>
		</ul></p>

	<p>Дополнительная функциональность:
	<ul>
		- Удаление записи
		- Форматирование записи
	</ul></p>

**2010-08-25: Проверка форматирования**

Мне нужен был способ форматировать сообщения в блоге. Это включало в себя устранение потенциальных рисков безопасности.

<p>Маркированный список:
	<ul>
		- **Жирный**
		- *Курсив*
		- <ins>Подчёркнутый</ins>
		- <del>Зачёркнутый</del>
	</ul></p>

	<p>Нумерованный список:
	<ol>
		- **Жирный**
		- *Курсив*
		- <ins>Подчёркнутый</ins>
		- <del>Зачёркнутый</del>
	</ol></p>

<p>Опасность:<br />
<code>notextile.
&lt;script&gt;document.body.onload=function(){document.body.innerHTML = 'JAVASCRIPT!!! ОПАСНОСТЕ';}&lt;/script&gt;</code></p>

<p>Опасность устранена:<br />
notextile. <script>document.body.onload=function(){document.body.innerHTML = &#8216;<span class="caps">JAVASCRIPT</span>!!! <span class="caps">ОПАСНОСТЕ</span>&#8217;;}</script></p>

**2010-08-25: 8-й шаг: Комментарии**

Следующий этап &#8211; комментарии.  Это создало несколько немедленных проблем:

<ul>
    <li>Регистрация</li>
    <li>Анти-спам меры</li>
    <li>Следует ли включать форматирование в комментариях?</li>
</ul>

**2010-08-29: Авторизация добавлена**

Авторизация добавлена.

**2010-08-30: Прикрутил комментарии**

**2010-09-06: Прикрутил комментарии. Попытка 2**

**2010-08-28: Метки**

Я реализовал метки для группировки сообщений и управления их отображением. Поля меток включают имя метки и ссылки на настройки конфиденциальности. Идея состоит в том, чтобы иметь метки, которые действуют как родители, чтобы упростить пометку сообщений. Например, если пользователь помечает сообщение как "C++", оно также должно быть помечено как "программирование".

Метки в конечном итоге будут использоваться для создания навигации по сайту.

Существуют синонимы меток (для предотвращения дубликатов) и родительские метки (для создания иерархической структуры).

Метка без родителя имеет специальное назначение. У метки может быть только один родитель. Если вам нужно включить статью в несколько разделов, назначьте ей несколько меток.

Специальные метки: конфиденциальность, категория сайта.

Метки конфиденциальности: опубликовано, частное, скрытое (требуется прямая ссылка).

Метки категорий: будни, хобби, обо мне, ...

Итак, у нас есть 4 типа меток:

<p>1. Метки категорий (подкатегории)<br />
2. Синонимы меток<br />
3. Языковые метки<br />
4. Метки конфиденциальности</p>

## Use Cases

<ul>
	<li>Назначить метку записи
		<ul>
			<li>Использовать существующую метку
				<ul>
					- Отобразить список меток
					- Отобразить список меток, начинающихся с заданной буквы
					- Выбрать метку
				</ul></li>
			<li>Создать новую метку
				<ul>
					- Ввести имя метки
					- Установить связи между метками
				</ul></li>
		</ul></li>
	<li>Отобразить записи по заданной метке
		<ul>
			- Отобразить список меток
			- Отобразить категорию метки (все сообщения с заданной меткой, синонимы заданной метки и метки, являющиеся ее потомками)
			- Не отображать сообщения с частной меткой незарегистрированным пользователям
			- Отображать сообщения с частной меткой зарегистрированным пользователям
		</ul></li>
</ul>

## Дизайн

Отношение "Метки конфиденциальности".

Отношение "Категории меток" many-to-many. Каждая метка может принадлежать к нескольким категориям. Каждая категория может содержать сообщения с несколькими метками.

Отношение "Синонимы меток" один-ко-многим. Каждая метка может иметь несколько синонимов. У каждого синонима есть одна метка, синонимом которой он является.

Я создал интерфейс для управления метками.

А также helper link_to_label(labelname).

Модель данных для меток

<table class="with-borders" style="margin:auto;">
	<tr>
		<th colspan="2">Метки</th>
	</tr>
	<tr>
		<th>Имя поля</th>
		<th>Тип</th>
	</tr>
	<tr>
		<td>id</td>
		<td>integer</td>
	</tr>
	<tr>
		<td>name</td>
		<td>string</td>
	</tr>
</table>

Модель данных для отношения метка-метка

Таблицы:

<p>create_table "appearances", do |t|<br />
	t.column "dancer_id", :integer, :null => false<br />
	t.column "movie_id", :integer, :null => false<br />
	t.column "character_name", :string<br />
	t.column "dance_numbers", :integer<br />
end</p>

Модели:

<p>class Appearance &lt; ActiveRecord::Base<br />
	belongs_to :dancer<br />
	belongs_to :movie<br />
end</p>

<p>class Dancer &lt; ActiveRecord::Base<br />
	has_many :appearances, :dependent => true<br />
	has_many :movies, :through => :appearances<br />
end</p>

<p>class Movie &lt; ActiveRecord::Base<br />
	has_many :appearances, :dependent => true<br />
	has_many :dancers, :through => :appearances<br />
end</p>

`rails generate scaffold Label id:string`

**2010-09-23: Метки добавлены!**

Метки добавлены! В настоящее время нет способа фильтровать сообщения по метке.

Добавить:

<ul>
	<li>Всплывающие подсказки по мере ввода меток (по образцу на Stackoverflow.com)</li>
	<li>Фильтрация сообщений по меткам</li>
</ul>

Присутствуют синонимы меток.

**2010-09-06: Формы множественного числа**

Ruby on Rails имеет встроенную поддержку форм множественного числа.

Например, можно отобразить строки "1 комментарий", "2 комментария", "5 комментариев" и т. д.

Для этого вызовите функцию translate следующим образом:

```ruby
t(:comments, :count => post.comments.size)
```

Здесь `:comments` - это склоняемая строка, `:count` - это переменная специального типа, `post.comments.size` - это фактическое количество комментариев.

В файле локализации `config/locales/ru.yml` у нас есть:

```yaml
    zero: 'Нет комментариев' # 0
    one: '%{count} комментарий' # 1, 21, 31, 41, 51, 61...
    few: '%{count} комментария' # 2-4, 22-24, 32-34...
    many: '%{count} комментариев' # 5-20, 25-30, 35-40...
```

Также необходимо установить gem "russian" для поддержки правил форм (few, many).

**2010-10-20: TODO: categories**

<p>Мне нужно разработать категории.<br />
Каждая категория состоит из множества меток.<br />
Каждая метка принадлежит к одной категории.<br />
Список категорий появляется в верхней части каждой страницы.</p>

**2010-11-27: Combine labels and folders**

Смешивание меток и папок.

<ul>
	<li>Пользователь может выбирать метки или иерархическое представление</li>
	<li>Пользователь может выбирать просмотр как метку или просмотр как папку</li>
	<li>Пользователь может выбрать метку и отобразить все элементы с этой меткой</li>
	<li>Пользователь может выбрать папку и отобразить только элементы в этой папке</li>
	<li>Пользователь может выбрать отображение корневых элементов</li>
	<li>Пользователь может выбрать отображение элементов без меток</li>
</ul>

**2010-09-03: Проблема со временем**

Информация о времени любого сообщения в Интернете обычно не содержит каких-либо явных указаний на часовой пояс, в котором находится автор. Обычно посетителю предоставляется время сообщения, скорректированное с учетом часового пояса сервера или часового пояса посетителя. И время сообщения регистрируется только как время по Гринвичу.

В результате теряется часть информации о сообщении, а именно местоположение его автора.

**2010-08-30: Вышел Ruby On Rails 3.0**

Уря! Я вовремя обновился!

&gt;&gt;&gt; [Новость на LORе](http://www.linux.org.ru/news/opensource/5280643)

**2010-08-25: Задачи**

	<p><span class="caps">TODO</span>:
	<ul>
	<li>Мелкие:
	<ul>
	- показывать лишь часть сообщения.
	- tab-order: remove toolbar.
	- время отображается по гринвичу.
	- HTML5 article tag.
	- <span class="caps">CSS</span> for code (<pre>)
	</ul></li>
	<li>Технические:
	<ul>
	<li>Статическое хранение (gollum, jekyll, nanoc)
	<ul>
	- Содержимое поста: asciidoc, markdown, textile&#8230;
	</ul></li>
	- haml
	</ul></li>
	<li>Функциональность:
	<ul>
	- Админ-панель
	- Последние обновления
	- About
	</ul></li>
	- Авторизация администратора, запрет редактирования пользователем.
	- Предпросмотр.
	- Добавление меток (тэгов).
	<li>Скрытие сообщений:
	<ul>
	- Скрытие одиночных сообщений (типы сообщений: приватное, публичное, на главной)
	- Скрытие групп сообщений (типы меток: приватные, публичные, на главной)
	- Одиночное сообщение без метки приватное.
	</ul></li>
	<li>Навигационная полоса
	<ul>
	- &#8220;где я сейчас нахожусь?&#8221;.
	- &#8220;куда я могу перейти?&#8221;.
	</ul></li>
	- Слияние нескольких сообщений в одно новое (или в существующее).
	- Наиболее часто меняемые?
	</ul></p>

### Следующие шаги

Куда я вижу развитие этого проекта? Я не уверен, но у меня есть несколько идей на будущее:

*    всплывающие подсказки по мере ввода меток (по образцу на Stackoverflow.com)
*   фильтрация сообщений по меткам
*   implement `sidewiki`

Это был сложный, но полезный путь, и я рад продолжить разработку этого блога!
