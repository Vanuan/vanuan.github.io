---
import Layout from "../../layouts/Layout.astro";
import PageHeader from "../../components/PageHeader.astro";
import { getCollection } from "astro:content";

const books = await getCollection("books");
const sortedBooks = books.sort(
    (a, b) => b.data.publishDate - a.data.publishDate,
);

// Get books in the Laws for Thinking Entities collection
const collectionBooks = books
    .filter((book) => book.data.collection === "Laws for Thinking Entities")
    .sort((a, b) => (a.data.order || 999) - (b.data.order || 999));

// Get standalone books (not part of any collection)
const standaloneBooks = books
    .filter((book) => !book.data.collection)
    .sort((a, b) => b.data.publishDate - a.data.publishDate);
---

<Layout
    title="Books | Creatives | Vanya Yani"
    description="Written works, stories, and narratives by Vanya Yani"
>
    <PageHeader
        title="Books"
        description="Written works, short stories, and longer narratives. Fiction and non-fiction pieces that dive into technology, philosophy, and the absurdities of modern life."
    />

    <section class="py-10">
        <div class="prose dark:prose-invert max-w-none mb-12">
            <p class="text-lg text-gray-600 dark:text-gray-300 leading-relaxed">
                Welcome to my literary experiments. These are stories born from
                the collision of human experience with our increasingly digital
                world. Some are complete, others are fragments - all are honest
                attempts to make sense of the chaos around us through the
                written word.
            </p>
        </div>

        {/* Featured Collection - Always show if we have collection books */}
        {
            collectionBooks.length > 0 ? (
                <div class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                        Featured Collection
                    </h2>
                    <div class="bg-gradient-to-br from-emerald-50 to-teal-50 dark:from-emerald-900/20 dark:to-teal-900/20 rounded-xl border border-emerald-200 dark:border-emerald-700 p-8">
                        <div class="flex items-start gap-6">
                            <div class="bg-emerald-100 dark:bg-emerald-900/30 p-4 rounded-xl">
                                <svg
                                    class="w-12 h-12 text-emerald-600 dark:text-emerald-400"
                                    fill="currentColor"
                                    viewBox="0 0 20 20"
                                >
                                    <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z" />
                                </svg>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                                    Laws for Thinking Entities
                                </h3>
                                <p class="text-gray-600 dark:text-gray-300 mb-4 leading-relaxed">
                                    A collection of eight stories exploring
                                    alternatives to futures that feel
                                    increasingly inevitable. Science fiction as
                                    cognitive infrastructure for the AI age.
                                </p>
                                <div class="text-sm text-gray-500 dark:text-gray-400 mb-6">
                                    {collectionBooks.length} Stories • Science
                                    Fiction • 2025
                                </div>
                                <a
                                    href="/creatives/books/laws-for-thinking-entities"
                                    class="inline-flex items-center bg-emerald-600 hover:bg-emerald-700 text-white font-medium px-4 py-2 rounded-lg transition-colors duration-200"
                                >
                                    Explore the Collection
                                    <svg
                                        class="w-4 h-4 ml-2"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M9 5l7 7-7 7"
                                        />
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            ) : null
        }

        {/* All Books */}
        <div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                {
                    standaloneBooks.length > 0
                        ? "Other Stories & Essays"
                        : "Stories & Essays"
                }
            </h2>
            {
                standaloneBooks.length > 0 ? (
                    <div class="space-y-8">
                        {standaloneBooks.map((book) => (
                            <article class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-8 shadow-sm hover:shadow-md transition-shadow duration-200">
                                <div class="flex items-start gap-6">
                                    <div class="bg-emerald-100 dark:bg-emerald-900/30 p-4 rounded-xl">
                                        <svg
                                            class="w-8 h-8 text-emerald-600 dark:text-emerald-400"
                                            fill="currentColor"
                                            viewBox="0 0 20 20"
                                        >
                                            <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z" />
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 mb-3">
                                            <h2 class="text-2xl font-bold">
                                                <a
                                                    href={`/creatives/books/${book.slug}`}
                                                    class="text-gray-900 dark:text-white hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors duration-200"
                                                >
                                                    {book.data.title}
                                                </a>
                                            </h2>
                                            {book.data.status && (
                                                <span
                                                    class={`px-3 py-1 rounded-full text-xs font-medium ${
                                                        book.data.status ===
                                                        "published"
                                                            ? "bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300"
                                                            : book.data
                                                                    .status ===
                                                                "in-progress"
                                                              ? "bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300"
                                                              : "bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"
                                                    }`}
                                                >
                                                    {book.data.status.replace(
                                                        "-",
                                                        " ",
                                                    )}
                                                </span>
                                            )}
                                        </div>
                                        <p class="text-gray-600 dark:text-gray-300 mb-4 leading-relaxed">
                                            {book.data.description}
                                        </p>
                                        <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
                                            <time
                                                datetime={book.data.publishDate.toISOString()}
                                            >
                                                {new Date(
                                                    book.data.publishDate,
                                                ).toLocaleDateString("en-US", {
                                                    year: "numeric",
                                                    month: "long",
                                                    day: "numeric",
                                                })}
                                            </time>
                                            {book.data.genre && (
                                                <span class="bg-emerald-100 dark:bg-emerald-900/30 text-emerald-800 dark:text-emerald-300 px-3 py-1 rounded-full text-xs font-medium">
                                                    {book.data.genre}
                                                </span>
                                            )}
                                            {book.data.tags &&
                                                book.data.tags.length > 0 && (
                                                    <div class="flex flex-wrap gap-2">
                                                        {book.data.tags.map(
                                                            (tag) => (
                                                                <span class="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded-md text-xs">
                                                                    #{tag}
                                                                </span>
                                                            ),
                                                        )}
                                                    </div>
                                                )}
                                        </div>
                                        <div class="mt-6">
                                            <a
                                                href={`/creatives/books/${book.slug}`}
                                                class="inline-flex items-center text-emerald-600 dark:text-emerald-400 hover:text-emerald-800 dark:hover:text-emerald-300 font-medium transition-colors duration-200"
                                            >
                                                Read more
                                                <svg
                                                    class="w-4 h-4 ml-1"
                                                    fill="none"
                                                    stroke="currentColor"
                                                    viewBox="0 0 24 24"
                                                >
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M9 5l7 7-7 7"
                                                    />
                                                </svg>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </article>
                        ))}
                    </div>
                ) : (
                    <div class="text-center py-16">
                        <div class="bg-gray-100 dark:bg-gray-800 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-6">
                            <svg
                                class="w-8 h-8 text-gray-400"
                                fill="currentColor"
                                viewBox="0 0 20 20"
                            >
                                <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">
                            No books yet
                        </h3>
                        <p class="text-gray-600 dark:text-gray-300">
                            The stories are still being written. Check back soon
                            for new releases!
                        </p>
                    </div>
                )
            }
        </div>
    </section>

    <!-- Back to Creatives -->
    <section class="py-8 border-t border-gray-200 dark:border-gray-700">
        <a
            href="/creatives"
            class="inline-flex items-center text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors duration-200"
        >
            <svg
                class="w-4 h-4 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 19l-7-7 7-7"></path>
            </svg>
            Back to Creatives
        </a>
    </section>
</Layout>
