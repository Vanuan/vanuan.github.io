---
import { getCollection } from "astro:content";
import Layout from "../../../layouts/Layout.astro";

export async function getStaticPaths() {
    const books = await getCollection("books");
    return books.map((book) => ({
        params: { slug: book.slug },
        props: { book },
    }));
}

interface Props {
    book: {
        id: string;
        slug: string;
        body: string;
        collection: string;
        data: {
            title: string;
            description: string;
            publishDate: Date;
            genre?: string;
            status?: "draft" | "published" | "in-progress";
            tags?: string[];
        };
    };
}

const { book } = Astro.props;
const { Content } = await book.render();
---

<Layout title={`${book.data.title} | Books | Creatives`} description={book.data.description}>
    <article class="max-w-4xl mx-auto py-8">
        <!-- Header Section -->
        <header class="mb-8 border-b border-gray-200 dark:border-gray-700 pb-6">
            <div class="flex items-center gap-4 mb-4">
                <div class="bg-emerald-100 dark:bg-emerald-900/30 p-3 rounded-lg">
                    <svg class="w-6 h-6 text-emerald-600 dark:text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"></path>
                    </svg>
                </div>
                <div class="flex-1">
                    <h1 class="text-4xl lg:text-5xl font-bold leading-tight text-gray-900 dark:text-white">
                        {book.data.title}
                    </h1>
                    {book.data.status && (
                        <span class={`inline-block mt-2 px-3 py-1 rounded-full text-xs font-medium ${
                            book.data.status === 'published'
                                ? 'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300'
                                : book.data.status === 'in-progress'
                                ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300'
                                : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'
                        }`}>
                            {book.data.status.replace('-', ' ')}
                        </span>
                    )}
                </div>
            </div>
            <p class="text-lg text-gray-600 dark:text-gray-300 mb-4 leading-relaxed">
                {book.data.description}
            </p>
            <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
                <time datetime={book.data.publishDate.toISOString()}>
                    Published on {new Date(book.data.publishDate).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    })}
                </time>
                {book.data.genre && (
                    <span class="bg-emerald-100 dark:bg-emerald-900/30 text-emerald-800 dark:text-emerald-300 px-3 py-1 rounded-full text-xs font-medium">
                        {book.data.genre}
                    </span>
                )}
                {book.data.tags && book.data.tags.length > 0 && (
                    <div class="flex flex-wrap gap-2">
                        {book.data.tags.map((tag) => (
                            <span class="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded-md text-xs">
                                #{tag}
                            </span>
                        ))}
                    </div>
                )}
            </div>
        </header>

        <!-- Content Section -->
        <div class="prose prose-lg dark:prose-invert max-w-none prose-headings:scroll-mt-20">
            <Content />
        </div>

        <!-- Navigation -->
        <footer class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
            <div class="flex justify-between items-center">
                <a
                    href="/creatives/books"
                    class="inline-flex items-center text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors duration-200"
                >
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Books
                </a>
                <a
                    href="/creatives"
                    class="inline-flex items-center text-emerald-600 dark:text-emerald-400 hover:text-emerald-800 dark:hover:text-emerald-300 transition-colors duration-200"
                >
                    All Creatives
                    <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </a>
            </div>
        </footer>
    </article>
</Layout>
